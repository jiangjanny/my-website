---
slug: SQL-Injection
title: 何謂隱碼攻擊
authors:
    name: Janny
    title: 何謂隱碼攻擊 (SQL injection)
    url: https://github.com/jiangjanny
    image_url: https://avatars.githubusercontent.com/u/109901097?s=96&v=4
tags: [SQL, injection, InternetSecurity]
---

SQL Injection 稱為 SQL 攻擊或隱碼攻擊，起因於當應用程式使用 SQL 語法對資料庫操作時，吋在漏洞導致資料庫內容超受攻擊、入侵或竊取，進而使得應用系統運作產生問題或造成損失。

攻擊者並不是上船病毒，而是攻擊者透過精心設計資料(內含部分的 SQL 語法)輸入到應用程式的查詢欄位，當應用程式設計不夠完善，未對自查詢欄位的資料進行檢查，當伺服器執行 SQL 指令時便會造成資料庫內容遭到破壞或竊取。

## 可能有以下幾種傷害 :

1. **資料外洩 :**
    - 攻擊者取得個人資料、帳戶資料、密碼
2. **被深知資料結構 :**
    - 經由漏洞知道資料表結構進而推敲出其他資訊做進一步的攻擊
3. **管理帳戶被竄改 :**
    - 一旦竄改管理者帳號攻擊者可以直接更改密碼，因此資料庫伺服器則會失守
4. **透過網頁進行更近一步破壞 :**
    - 當攻擊者取得更進一步的最高管理權限，攻擊者很可能再 網頁加入惡意連結以及 XSS 攻擊，藉此攻擊引導使用者去不良網站進行網路釣魚竊取使用者的帳密資訊。
5. **修改或控制作業系統 :**
    - 攻擊者可能利用資料庫伺服器所提供的作業系統操作支援，讓攻擊者可以控制或修改作業系統
6. **破壞系統 :**
    - 攻擊者可能透過資料伺服器支援作業系統的操作，破壞硬碟資料造成全系統癱瘓，例如 下指令進行硬碟格式化

## 避免被攻擊的方式:

1. **使用參數化查詢 (Parameterized query) :**
    - 應用程式再開發的時候應該全面使用參數化進行資料存取查詢，如此可以避免由惡意的資料庫字串造成危害系統的查詢語言
2. **對傳入的參數進行前處理 :**
    - 應用程式再接收到傳入的參數時應先進行字元取代的動作，例如使用連續兩個單引號字元取代單引號。使用 PHP 語言開發應用系統或網頁時應善用 PHP 的 Magic quote 函數
3. **定期更新套件 :**
    - 資料庫套件定期更新有效預防漏洞的產生，以維護資料庫的安全性避免各式各樣的資料庫攻擊
4. **使用更安全的資料庫連結元件 :**
    - 當資料庫管理系統推出可避免 SQL injection 攻擊的資料庫元件，資料庫管理員應提醒系統開發人員或系統維護人員進行資料庫元件的更新。

## 隱碼攻擊手法

1. 網頁系統設計使用者身分認證，使用者輸入帳號密碼查詢並判斷資料庫系統回傳的筆數判斷時，則攻擊者可以很容易的通過系統認證而進入系統
2. 要了解隱碼攻擊手法前必須先了解結構化查詢語言

## 結構化查詢語言

> Structured Query Language (SQL)

SQL 是一種進行資料庫操作的結構化語言，目前常用的資料庫管理系統大部分都支援 SQL 操作，只要有支援 SQL 的資料庫查詢語言都有可能遭受 SQL Injection 攻擊。

## SQL injection 可以分成三大類：

### 一、In-band SQL 注入攻擊

In-band SQL 注入攻擊，也稱為「經典 SQL 注入」，是駭客利用同一個介面發動攻擊並收集資料的一種方式。這種攻擊方式最為常見，主要分為兩種子類別：

-   **Error-based**：通過故意製造 SQL 錯誤來獲取資料庫結構資訊。
-   **Union-based**：使用 SQL 的 Union 運算子將多個查詢結果合併，從而在一個欄位中提取多項資料。

### 二、Inferential SQL 注入攻擊（Blind SQL 注入）

當網站不直接提供錯誤信息時，駭客可以通過反覆測試和觀察反應來推斷資料庫的結構。這種方式耗時較長，但威脅性較高，分為兩種子類別：

-   **Boolean-based**：根據伺服器回應的真假來判斷查詢的條件是否成立。
-   **Time-based**：通過觀察伺服器回應時間來推斷查詢的結果。

### 三、Out-of-band SQL 注入攻擊

Out-of-band SQL 注入攻擊使用不同的通訊管道來攻擊和收集資料，通常依賴於與資料庫連接的其他系統，如 DNS 或 HTTP 回應。這種攻擊方式受限於目標伺服器的特定設置，因此使用較少。

## 防範 SQL 注入攻擊的常見方法有以下八種：

1. **使用預處理語句（Prepared Statements）**：
   預處理語句可以有效防止 SQL 注入攻擊，因為它們將 SQL 語句和輸入資料分開處理，確保使用者輸入不會被當作 SQL 指令執行。

2. **使用參數化查詢**：
   參數化查詢和預處理語句類似，通過將使用者輸入作為參數傳遞，而不是直接插入 SQL 語句中，從而避免注入攻擊。

3. **輸入驗證和清理**：
   驗證和清理所有來自使用者的輸入，確保它們符合預期格式，並過濾掉特殊字符，如單引號、分號等，這些字符可能被用於構造惡意 SQL 語句。

4. **使用 ORM（物件關係映射）框架**：
   ORM 框架通過將資料庫操作抽象化，減少直接書寫 SQL 查詢的機會，有助於減少 SQL 注入的風險。

5. **最小化資料庫權限**：
   為應用程式設定最小權限的資料庫用戶，這樣即使攻擊成功，駭客也無法對資料庫進行大範圍的操作。

6. **使用存儲過程（Stored Procedures）**：
   存儲過程在資料庫中預先定義了 SQL 查詢，並使用參數來處理輸入。由於存儲過程不會將使用者輸入直接插入 SQL 查詢中，因此可以有效防止 SQL 注入。

7. **持續更新和修補**：
   定期更新和修補應用程式及其依賴的資料庫和框架，以修復已知的安全漏洞，防止攻擊者利用漏洞進行 SQL 注入攻擊。
8. **使用白名單（White List）：**
   白名單是指只允許經過驗證的、安全的輸入或操作。當應用程式需要處理使用者輸入時，通過白名單的方式僅接受符合預期的特定值或格式，這樣可以防止不受信任的數據被用來構建 SQL 查詢。比如在選擇排序欄位或條件時，僅允許來自預先定義的安全列表的值，從而避免惡意輸入造成的 SQL 注入攻擊。

這些方法可以有效減少 SQL 注入攻擊的風險，保護應用程式和資料庫的安全。

---

> 參考文章
>
> 1. [數位內容資訊安全--SQL Injection 介紹](https://www.youtube.com/watch?v=qX9MYSeFp_Q)
> 2. [簡單 SQL 語法](https://paper.dropbox.com/doc/SQL-Tutorial--A0Lkm1bzHHOGgHmfuFSU6RkNAQ-jd7nR2SwH5LAdGMJ5rqNP)
