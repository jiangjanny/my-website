---
slug: 檔案上傳安全
title: 你知道檔案上傳安全知識嗎?
authors:
    name: Janny
    title: 你知道檔案上傳安全知識嗎?
    url: https://github.com/jiangjanny
    image_url: https://avatars.githubusercontent.com/u/109901097?s=96&v=4
tags: [InternetSecurity]
---

> 許多上傳形象網頁、系統服務或多或少都會有上傳的功能，現今大多都移到雲端空間這時就必須確保上傳檔案的安全性，如果不加以管控可能會被攻擊的風險

## 有甚麼上傳檔案的風險?

1. **對於你的基礎設施作攻擊 :**

-   如果新上傳的檔案與以存入的檔案明子重複會有資料覆蓋的問題
-   新上傳的檔案是非常重要的，則有可能會被利用拿來發動攻擊伺服器，嚴重導致網站不再運行，或是可能損害安全設備進而允許攻擊者上傳其他惡意檔案並對您進行勒索贖金。

2. **對你的用戶作攻擊 :**

-   上傳的檔案如果包含惡意的病毒有可能會感染使用這的電腦

3. **服務氣中斷 :**

-   當上傳的檔案過大的時候可能會導致伺服器資源的大量消耗定中斷使用者的服務

## 如何防止檔案上傳攻擊?

1. **只允許特定的文件類型。**
   透過限制允許的檔案類型列表，您可以避免將可執行檔、腳本和其他潛在的惡意內容上傳到您的應用程式。

2. **驗證文件類型。**
   除了限製文件類型之外，確保沒有文件被「封鎖」為允許的文件類型也很重要。例如，如果攻擊者將 .exe 重新命名為 .docx，並且您的解決方案完全依賴檔案副檔名，它將繞過您作為 Word 文件的檢查，但事實上它不是。因此，在允許上傳文件之前驗證文件類型非常重要。

3. **掃描惡意軟體**
   為了最大限度地降低風險，應掃描所有文件是否有惡意軟體。我們建議使用多個反惡意軟體引擎（結合使用簽章、啟發式和機器學習偵測方法）對檔案進行多重掃描，以獲得最高的偵測率和最短的惡意軟體爆發暴露時間。

4. **消除可能的嵌入威脅**
   Microsoft Office、PDF 和圖像檔案等檔案可能在隱藏腳本和巨集中嵌入了威脅，而反惡意軟體引擎並不總是能夠偵測到這些威脅。為了消除風險並確保檔案不包含隱藏威脅，最佳做法是使用稱為內容解除和重建 (CDR) 的方法來刪除任何可能的嵌入物件。

5. **驗證用戶身份**
   為了提高安全性，最好要求使用者在上傳檔案之前進行身份驗證。然而，這並不能保證使用者的機器本身不會受到損害。

6. **設定最大名稱長度和最大檔案大小**
   確保設定最大名稱長度（如果可能，限制允許的字元）和檔案大小，以防止潛在的服務中斷。

7. **隨機化上傳的檔案名稱。**
   隨機更改上傳的檔案名，使攻擊者無法嘗試使用他們上傳的檔案名稱存取該檔案。使用 Deep CDR 時，您可以將清理後的檔案配置為隨機識別碼（例如分析 data_id）。

8. **將上傳的檔案儲存在 Web 根資料夾之外。**
   檔案上傳的目錄應該在網站的公共目錄之外，這樣攻擊者就無法透過指定的路徑 URL 執行檔。

9. **檢查文件中的漏洞。**
   確保在上傳軟體和韌體檔案之前檢查其是否有漏洞。

10. **使用簡單的錯誤訊息。**
    顯示檔案上傳錯誤時，請勿包含目錄路徑、伺服器設定設定或攻擊者可能用來進一步進入您的系統的其他資訊。
