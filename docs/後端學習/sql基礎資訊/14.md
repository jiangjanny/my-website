---
slug: 多表查詢
title: 多表查詢
authors:
    name: Janny
    title: 多表查詢
    url: https://github.com/jiangjanny
    image_url: https://avatars.githubusercontent.com/u/109901097?s=96&v=4
tags: [SQL]
---

從你提供的 .md 檔內容來看，有一些錯誤和需要改進的地方。以下是逐項檢查和修正：

### 1. YAML 標頭

**問題**：YAML 標頭的縮排正確，但如果沒有分隔行（`---`）之間的空行，可能會影響解析。確保 `---` 前後有空行。

**修正**：

```yaml
---
slug: 多表查詢
title: 多表查詢
authors:
    name: Janny
    title: 多表查詢
    url: https://github.com/jiangjanny
    image_url: https://avatars.githubusercontent.com/u/109901097?s=96&v=4
tags: [SQL]
---
```

### 2. SQL 語法

#### INNER JOIN 範例

**問題**：結果表格和 SQL 查詢的結果不一致。內部連接應該只返回兩個表中都有的匹配記錄。

**修正**：

```sql
SELECT customers.name, orders.order_id, orders.amount
FROM customers
INNER JOIN orders ON customers.customer_id = orders.customer_id;
```

**結果**：
| name | order_id | amount |
|---------|----------|--------|
| Alice | 101 | 150 |
| Bob | 102 | 200 |
| Alice | 103 | 300 |
| Charlie | 104 | 120 |

#### LEFT JOIN 範例

**問題**：結果表格與 SQL 查詢結果一致，但這裡應該強調，這將返回所有顧客及其訂單，即使顧客沒有訂單，訂單欄位顯示為 NULL。

**修正**：

```sql
SELECT customers.name, orders.order_id, orders.amount
FROM customers
LEFT JOIN orders ON customers.customer_id = orders.customer_id;
```

**結果**：
| name | order_id | amount |
|---------|----------|--------|
| Alice | 101 | 150 |
| Bob | 102 | 200 |
| Alice | 103 | 300 |
| Charlie | 104 | 120 |

#### RIGHT JOIN 範例

**問題**：RIGHT JOIN 範例與 SQL 查詢結果一致。此查詢應返回所有訂單及其對應的顧客，即使訂單沒有對應顧客，顧客欄位顯示為 NULL。

**修正**：

```sql
SELECT customers.name, orders.order_id, orders.amount
FROM customers
RIGHT JOIN orders ON customers.customer_id = orders.customer_id;
```

**結果**：
| name | order_id | amount |
|---------|----------|--------|
| Alice | 101 | 150 |
| Bob | 102 | 200 |
| Alice | 103 | 300 |
| Charlie | 104 | 120 |

#### FULL OUTER JOIN 範例

**問題**：在一些資料庫系統中可能不支持 FULL OUTER JOIN。結果應包括所有顧客和訂單。

**修正**：

```sql
SELECT customers.name, orders.order_id, orders.amount
FROM customers
FULL OUTER JOIN orders ON customers.customer_id = orders.customer_id;
```

**結果**：
| name | order_id | amount |
|---------|----------|--------|
| Alice | 101 | 150 |
| Bob | 102 | 200 |
| Alice | 103 | 300 |
| Charlie | 104 | 120 |

#### UNION 範例

**問題**：`UNION` 操作要求所有查詢返回的欄位數目和數據類型相同。這裡顯然將顧客名稱和城市與訂單號和金額進行了合併，數據類型不匹配。

**修正**：

```sql
SELECT name, city FROM customers
UNION
SELECT CAST(order_id AS TEXT) AS name, CAST(amount AS TEXT) AS city FROM orders;
```

**結果**：
| name | city |
|------|-------|
| Alice | Taipei |
| Bob | Taichung |
| Charlie | Kaohsiung |
| 101 | 150 |
| 102 | 200 |
| 103 | 300 |
| 104 | 120 |

### 3. 表格對齊

**問題**：確保表格的格式一致，邊框對齊正確。所有表格應以 `|` 來分隔欄位和行。

**修正**：

-   **顧客表** 和 **訂單表** 的格式已經對齊。

### 4. 迪卡爾積範例

**問題**：範例 SQL 和結果正確，但要注意 `CROSS JOIN` 會產生大量結果。

**修正**：

```sql
SELECT products.product_name, suppliers.supplier_name
FROM products
CROSS JOIN suppliers;
```

**結果**：
| product_name | supplier_name |
|--------------|---------------|
| Pen | Supplier A |
| Pen | Supplier B |
| Notebook | Supplier A |
| Notebook | Supplier B |

### 5. 自連接 vs 非自連接

**問題**：自連接和非自連接的描述和範例正確，只需確保表格格式一致，且 `INNER JOIN` 和 `JOIN` 的語法一致。

### 6. 內連接 vs 外連接

**問題**：描述和範例正確，但確保表格格式一致，描述清晰。

**修正**：

-   **內連接**：用於提取匹配記錄。
-   **外連接**：返回至少一個表中的所有記錄，包括未匹配的記錄。
